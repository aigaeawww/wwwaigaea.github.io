import{z as g,O as d,X as A,L as l,as as f,ce as w}from"./entry.f105df37.js";import{J as y,c as I,C,a as p}from"./useContract.b0b1c6d7.js";import{a as m}from"./verification.fd8b49e2.js";const B=async()=>{var e;try{const a=g(),s=d();if(s.getIsPayCard||!((e=a.getUserInfo)!=null&&e.eth_address))return;const t=s.getWeb3ConfigData||[];for(const o of t)try{const r=new y(o.rpc),n=o.invite,c=I("inviteABI"),i=await new C(n,c,r).isgodhoodID(a.getUserInfo.eth_address);if(i)return s.setIsPayCard(i||!1)}catch{}return!1}catch{return!1}},x=async(e,a)=>{try{const s=d(),t=await A();if(!t)return null;await s.getAccountWalletItem.enable();const o=await p("usd","authorizeABI",a),r=a.invite,n=await o.methods.allowance(t,r).call(),c=Number(await o.methods.decimals().call()),u=parseInt(n,10),i=10*10**c,v=Number(i);return u>=v?await h(e,t,a):(await o.methods.approve(r,i).send({from:t})).transactionHash?await h(e,t,a):(l.error("Authorization failed"),null)}catch(s){const t=m(s==null?void 0:s.message);return t?f(t,a.explorer):l.error("Transaction failed"),null}},h=async(e,a,s)=>{try{const t=d(),o=e||w,n=await(await p("invite","inviteABI",s)).methods.inviter(o).send({from:a}),c=t.getApproveHash;return{eth_address:a,approveHash:c,invierHash:n.transactionHash}}catch(t){const o=m(t==null?void 0:t.message);return o?f(o,s.explorer):l.error("Transaction failed"),null}};export{x as b,B as c};
