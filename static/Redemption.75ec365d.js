import{d as W,r as p,z as q,O as X,g as r,o as u,C as Y,x as y,v as k,b as t,t as d,e as o,I as J,c as f,B as F,N as K,_ as Z,L as n,X as ee}from"./entry.f105df37.js";import{E as te}from"./el-button.99f697ac.js";import{E as se,_ as oe}from"./el-overlay.1d307549.js";import{s as ae}from"./utils.6576f7a5.js";import{d as le}from"./ticket.659f1e5e.js";import{s as ne,f as ce,b as ie}from"./checkBalance.bc099f32.js";import{b as re,a as ue}from"./BuyTicket.61700a45.js";import{t as de}from"./throttle.e6b946ec.js";import{_ as pe}from"./tickets.783eba8d.js";import"./use-form-item.ecbcfbcd.js";import"./verification.fd8b49e2.js";import"./el-input.b010e971.js";import"./useContract.b0b1c6d7.js";import"./commonjsHelpers.042e6b4d.js";import"./-vite-browser-externalcommonjs-proxy.005f2268.js";import"./plugin-vueexport-helper.c27b6911.js";import"./el-loading.ce515ce7.js";const x=""+globalThis.__publicAssetsURL("images/public/line.png"),fe=K(()=>Z(()=>import("./WalletSelection.afc49511.js"),["./WalletSelection.afc49511.js","./el-overlay.1d307549.js","./entry.f105df37.js","./entry.4ce58bf5.css","./verification.fd8b49e2.js","./el-input.b010e971.js","./use-form-item.ecbcfbcd.js","./el-input.c43a23be.css","./el-overlay.155e27a7.css","./useContract.b0b1c6d7.js","./utils.6576f7a5.js","./commonjsHelpers.042e6b4d.js","./-vite-browser-externalcommonjs-proxy.005f2268.js","./WalletSelection.c4aa2964.css"],import.meta.url).then(v=>v.default||v)),_e={class:"px-5 flex flex-col items-center pb-10 text-[#ebebeb]"},me=t("p",{class:"text-[24px] font-[500] mb-4"},"REDEMPTION",-1),he=t("div",{class:"w-full h-[80px] py-2 px-8 flex items-center justify-around relative"},[t("div",{class:"w-full h-1 absolute top-0 opacity-80"},[t("img",{src:x,alt:"",class:"w-full h-full object-cover"})]),t("div",{class:"w-full h-1 absolute bottom-0 opacity-80"},[t("img",{src:x,alt:"",class:"w-full h-full object-cover"})]),t("div",{class:"w-fit h-full"},[t("img",{src:pe,alt:"",class:"w-full h-full object-contain"})]),t("span",{class:"text-[18px] uppercase"},"Purchase Ticket")],-1),xe={class:"w-full h-[70px] flex items-center justify-around px-8"},ve=t("span",{class:"w-[80px] text-[16px]"},"Quantity",-1),ge={class:"w-[150px] h-[32px] flex items-center justify-between rounded-[15px] px-3 border border-[#707070]"},be={class:"text-white px-4 text-[1rem] font-sans"},we={class:"w-full h-[70px] flex items-center justify-between relative"},ye=t("div",{class:"w-full h-1 absolute top-0 opacity-80"},[t("img",{src:x,alt:"",class:"w-full h-full object-cover"})],-1),ke=t("span",{class:"text-[16px] ml-12"},"Tickets",-1),Ee={class:"text-[18px] mr-12"},Ce={class:"w-full h-[70px] flex items-center justify-between relative"},Se=t("div",{class:"w-full h-1 absolute top-0 opacity-80"},[t("img",{src:x,alt:"",class:"w-full h-full object-cover"})],-1),De=t("div",{class:"w-full h-1 absolute bottom-0 opacity-80"},[t("img",{src:x,alt:"",class:"w-full h-full object-cover"})],-1),Ie=t("span",{class:"text-[16px] ml-12"},"Fee",-1),Te={key:0,class:"text-[18px] mr-12 space-x-1"},Ne={key:0,class:"line-through font-sans text-[14px] text-[#707070]"},Ae={key:1},Ue={key:2},Be={key:3,class:"text-[12px] text-[#707070]"},je={key:1,class:"text-[18px] mr-12 space-x-1"},Fe={class:"w-[85%] h-[34px] flex items-center justify-between rounded-[15px] bg-[#707070] px-5 mt-2 mb-10"},Me=t("span",{class:"font-[500] text-[14px] uppercase"},"paired wallet",-1),Oe={class:"flex items-center space-x-1"},Pe=t("span",{class:"w-2 h-2 bg-green-400 rounded-full"},null,-1),Ge={class:"font-[500] text-[14px]"},He={class:"w-[85%] flex items-center justify-between"},Le=t("span",{class:"font-[500] text-[12px] uppercase"},"CANCEL",-1),Re=t("span",{class:"font-[500] text-[12px] uppercase"},"CONFIRM",-1),T=1,Ve=0,$e="USDC balance insufficient",Qe="ETH balance is insufficient",ze="Ticket purchase successful",We="Only users with Godhood ID card can purchase.",dt=W({__name:"Redemption",props:{dialogVisible:{type:Boolean,default:!1},item:{default:()=>null}},emits:["update:closeDialog","update:success"],setup(v,{emit:N}){const c=v,E=p(!1),A=q(),C=p(!1),l=p(T),U=X(),i=p(null),S=p(""),g=p(!1),B=r(()=>{var e;return((e=c.item)==null?void 0:e.level)===1}),M=r(()=>{var e;return(e=c.item)!=null&&e.quantity?c.item.quantity*l.value:0}),D=r(()=>{var e;return 100-(((e=i.value)==null?void 0:e.percentage)||100)>Ve}),O=r(()=>{var e;return 100-(((e=i.value)==null?void 0:e.percentage)||100)}),j=r(()=>{var s;if(!((s=c.item)!=null&&s.afterDiscount))return"0.00";const e=c.item.afterDiscount*l.value;return parseFloat(e.toFixed(2)).toString()}),P=r(()=>{var s,a;if(!((s=c.item)!=null&&s.afterDiscount)||!((a=i.value)!=null&&a.percentage))return"0.00";const e=c.item.afterDiscount*l.value*(i.value.percentage/100);return parseFloat(e.toFixed(2)).toString()}),G=r(()=>{var s,a;const e=((s=A.getUserInfo)==null?void 0:s.eth_address)||((a=A.getUserInfo)==null?void 0:a.sol_address);return e?ae({value:e,characters:"***",start:4}):""}),I=()=>{N("update:closeDialog"),l.value=T,i.value=null,S.value=""},H=async()=>{await $()},L=()=>{l.value>T&&l.value--},R=()=>{B.value||l.value++},V=()=>{var e;(e=i.value)!=null&&e.final_hash?C.value=!0:n.error(S.value||"Ticket payment maintenance, will be restored later.")},$=async()=>{var e;try{g.value=!0;const s=await le(((e=c.item)==null?void 0:e.level)||0);s.code===200?i.value=s.data:(S.value=s.msg,n.error(s.msg))}catch{n.error("An error occurred while fetching ticket information.")}finally{g.value=!1}},Q=async()=>{try{await ne(U.getAccountWalletItem);const e=await ee();if(!e){n.error("Failed to get wallet address");return}if(!i.value){n.error("No ticket generation info available");return}const{final_hash:s,percentage:a,level:b}=i.value,[w,_]=await Promise.all([ce(e),ie(e)]),m=Number((c.item.afterDiscount*l.value).toFixed(2))*(a/100)||0;if(_===0||_<m){n.warning(`${$e}, current balance is ${_}`);return}if(w<=1e-4){n.warning(`${Qe}, current balance is ${w}`);return}let h;l.value===1?h=await re(b,a,s,e,Math.ceil(m)):h=await ue(b,l.value,a,s,e,Math.ceil(m)),h&&typeof h=="string"&&h.length>0&&(n.success(ze),I(),N("update:success"))}catch{n.error("An error occurred during the purchase process.")}finally{E.value=!1}},z=()=>{if(!U.getIsPayCard){n.warning(We);return}E.value=!0,Q()};return(e,s)=>{const a=te,b=fe,w=se,_=oe;return u(),Y(_,null,{default:y(()=>[k(w,{class:"border-box",draggable:"","model-value":e.dialogVisible,"show-close":!1,width:"400px",style:{background:"#1f1f1f",border:"1px solid #707070"},"align-center":"",onClose:I,onOpen:H,"append-to-body":!1},{default:y(()=>[t("div",_e,[me,he,t("div",xe,[ve,t("div",ge,[t("div",{class:"text-white px-2 text-[1.25rem] font-bold cursor-pointer select-none",onClick:L}," - "),t("span",be,d(o(l)),1),t("div",{class:J(["text-white px-2 text-xl font-bold select-none",o(B)?"cursor-not-allowed":"cursor-pointer"]),onClick:R}," + ",2)])]),t("div",we,[ye,ke,t("span",Ee,d(o(M)),1)]),t("div",Ce,[Se,De,Ie,o(g)?(u(),f("span",je,"-")):(u(),f("span",Te,[o(D)?(u(),f("span",Ne,d(o(j)),1)):F("",!0),o(D)?(u(),f("span",Ae,d(o(P))+" USDC ",1)):(u(),f("span",Ue,d(o(j))+" USDC",1)),o(D)?(u(),f("span",Be," ("+d(o(O))+"% off) ",1)):F("",!0)]))]),t("div",Fe,[Me,t("div",Oe,[Pe,t("span",Ge,d(o(G)),1)])]),t("div",He,[k(a,{class:"w-full hover:scale-105 duration-500",color:"#434343",style:{height:"34px"},onClick:I},{default:y(()=>[Le]),_:1}),k(a,{class:"w-full hover:scale-105 duration-500",color:"#B5B5B5",style:{height:"34px"},loading:o(E)||o(g),onClick:s[0]||(s[0]=m=>("throttle"in e?e.throttle:o(de))(()=>V()))},{default:y(()=>[Re]),_:1},8,["loading"])]),k(b,{"dialog-visible":o(C),"onUpdate:success":z,"onUpdate:closeDialog":s[1]||(s[1]=m=>C.value=!1)},null,8,["dialog-visible"])])]),_:1},8,["model-value"])]),_:1})}}});export{dt as default};
