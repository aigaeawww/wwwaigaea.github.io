import{d as q,r as v,h as at,n as nt,o as A,c as P,b as t,z as G,L as _,as as $,O as W,J as ct,C as lt,x as z,v as B,t as I,e as d,D as it,F as rt,H as dt,I as ut,N as F,_ as J,k as pt,l as ft,q as N}from"./entry.f105df37.js";import{E as xt}from"./el-input.b010e971.js";import{E as _t}from"./el-button.99f697ac.js";import{_ as Q}from"./plugin-vueexport-helper.c27b6911.js";import{E as mt,_ as ht}from"./el-overlay.1d307549.js";import{v as gt}from"./el-loading.ce515ce7.js";import{i as H}from"./utils.6576f7a5.js";import{b as vt,c as yt}from"./ticket.659f1e5e.js";import{u as bt,a as j}from"./useContract.b0b1c6d7.js";import{a as S}from"./verification.fd8b49e2.js";import{t as wt}from"./throttle.e6b946ec.js";import{_ as K}from"./tickets.783eba8d.js";const kt={class:"barcode-container opacity-80"},Bt=q({__name:"Barcode",setup(l){const p=v(null);function f(e=50,a=1,n=1){const o=[];for(let i=0;i<e;i++){const c=Math.floor(Math.random()*(n-a+1))+a;o.push(c)}return o}function s(e,a){const n=e.getContext("2d");if(!n)return;let o=0;const i=a.reduce((m,w)=>m+w,0),c=e.width/i,g=255/i;a.forEach((m,w)=>{if(w%2===0)n.fillStyle="#000";else{const E=Math.floor(255-o*g),L=`rgb(${E}, ${E}, ${E})`;n.fillStyle=L}const D=m*c;n.fillRect(o,0,D,e.height),o+=D})}return at(async()=>{var o;await nt();const e=(o=p.value)==null?void 0:o.parentElement;if(!e)return;const a=e.clientWidth;p.value.width=a,p.value.height=22;const n=f(150,1,3);s(p.value,n)}),(e,a)=>(A(),P("div",kt,[t("canvas",{ref_key:"barcodeCanvas",ref:p},null,512)]))}});const It=Q(Bt,[["__scopeId","data-v-500bfd46"]]),Dt=async()=>{var l,p,f;try{const s=G(),e=s.getUserInfo.eth_address||s.getUserInfo.sol_address;return e?await(await bt("ticket","topUpTicketABI")).canPurchaseLevel1(e):void 0}catch(s){const e=S((s==null?void 0:s.message)||((l=s==null?void 0:s.data)==null?void 0:l.message)||(s==null?void 0:s.msg));if(e)$(e);else return _.error(((p=s==null?void 0:s.data)==null?void 0:p.message)||((f=s==null?void 0:s.error)==null?void 0:f.message)||"Transaction failed");return null}},X=async(l,p)=>{var f,s;try{const e=W(),a=await j("usd","authorizeABI"),n=e.getWeb3ConfigItem.ticket,o=await a.methods.decimals().call(),i=BigInt(Math.floor(Number(p)*Math.pow(10,Number(o)))).toString(),c=await a.methods.allowance(l,n).call(),g=parseInt(c,10),m=parseInt(i,10);return g>=m||(await a.methods.approve(n,i).send({from:l})).transactionHash?!0:(_.error("Authorization failed"),!1)}catch(e){const a=S(e==null?void 0:e.message);if(a)$(a);else return _.error(((f=e==null?void 0:e.data)==null?void 0:f.message)||((s=e==null?void 0:e.error)==null?void 0:s.message)||"error");return null}},Pe=async(l,p,f,s,e)=>{var a,n;try{if(await X(s,e))return(await(await j("ticket","topUpTicketABI")).methods.buyTickets(l,p,f).send({from:s})).transactionHash}catch(o){const i=S(o==null?void 0:o.message);if(i)$(i);else return _.error(((a=o==null?void 0:o.data)==null?void 0:a.message)||((n=o==null?void 0:o.error)==null?void 0:n.message)||"error");return null}},$e=async(l,p,f,s,e,a)=>{var n,o,i;try{return await X(e,a)?(await(await j("ticket","topUpTicketABI")).methods.buyTicketsBatch(l,p,f,s).send({from:e})).transactionHash:_.error("Authorization failed")}catch(c){const g=S((c==null?void 0:c.message)||((n=c==null?void 0:c.error)==null?void 0:n.message));if(g)$(g);else return _.error(((o=c==null?void 0:c.data)==null?void 0:o.message)||((i=c==null?void 0:c.error)==null?void 0:i.message)||"error");return null}},Et=F(()=>J(()=>import("./Redemption.75ec365d.js"),["./Redemption.75ec365d.js","./entry.f105df37.js","./entry.4ce58bf5.css","./el-button.99f697ac.js","./use-form-item.ecbcfbcd.js","./el-button.2e70eb9e.css","./el-overlay.1d307549.js","./verification.fd8b49e2.js","./el-input.b010e971.js","./el-input.c43a23be.css","./el-overlay.155e27a7.css","./utils.6576f7a5.js","./ticket.659f1e5e.js","./checkBalance.bc099f32.js","./useContract.b0b1c6d7.js","./commonjsHelpers.042e6b4d.js","./-vite-browser-externalcommonjs-proxy.005f2268.js","./throttle.e6b946ec.js","./tickets.783eba8d.js","./plugin-vueexport-helper.c27b6911.js","./el-loading.ce515ce7.js","./el-loading.7fcbe426.css"],import.meta.url).then(l=>l.default||l)),Tt=F(()=>J(()=>import("./TicketRecord.c509b71a.js"),["./TicketRecord.c509b71a.js","./el-pagination.01abb38e.js","./entry.f105df37.js","./entry.4ce58bf5.css","./el-popper.ac949242.js","./el-input.b010e971.js","./use-form-item.ecbcfbcd.js","./el-input.c43a23be.css","./verification.fd8b49e2.js","./el-popper.adf0c150.css","./el-checkbox.00032e92.js","./-initCloneObject.0972cb9e.js","./el-checkbox.3ca32550.css","./debounce.e1ecbbcb.js","./validator.59a6b518.js","./commonjsHelpers.042e6b4d.js","./el-pagination.797b2710.css","./el-overlay.1d307549.js","./el-overlay.155e27a7.css","./el-loading.ce515ce7.js","./el-loading.7fcbe426.css","./utils.6576f7a5.js","./ticket.659f1e5e.js","./plugin-vueexport-helper.c27b6911.js","./TicketRecord.32a6c731.css"],import.meta.url).then(l=>l.default||l)),u=l=>(pt("data-v-1fe91fef"),l=l(),ft(),l),Ct={class:"px-10 pb-8 grid grid-cols-[310px_1fr] gap-4"},At={class:"h-fit border-2 border-[#2b2b2b] px-6 pt-5 pb-10 flex flex-col space-y-6"},Ut=u(()=>t("p",{class:"text-[#ebebeb] text-[28px] font-[700] font-display text-center"},[N("TRANSFER "),t("br"),N("AS A GIFT ")],-1)),Pt=u(()=>t("div",{class:"text-left font-[500] text-[#EBEBEB] text-[16px]"},"BALANCE",-1)),$t={class:"flex items-center justify-center space-x-2"},St=u(()=>t("div",{class:"w-[45%]"},[t("img",{src:K,alt:"",class:"w-full h-auto"})],-1)),Lt={class:"text-[#ebebeb] text-[36px] font-[700]"},Rt=u(()=>t("span",null,"*",-1)),zt={class:"relative top-1"},Ht={class:"w-full flex flex-col items-center justify-between space-y-3"},jt={class:"w-full flex items-center justify-between py-2"},Vt=u(()=>t("span",{class:"w-[90px] text-[16px] font-[500] text-[#ebebeb]"},"UID",-1)),Ot={class:"flex-1"},Mt=u(()=>t("p",{class:"text-[12px] font-[400] text-[#62A48E] mt-1"},"· UIDs with enter separation",-1)),Nt={class:"w-full flex items-center justify-between"},qt=u(()=>t("span",{class:"w-[90px] text-[16px] font-[500] text-[#ebebeb]"},"Quantity",-1)),Gt={class:"h-[32px] flex-1 flex items-center justify-between rounded-[5px] px-3 border border-[#2B2B2B]"},Wt={class:"text-white px-4 text-[1rem] font-sans"},Ft={class:"flex flex-col items-center space-y-2"},Jt=u(()=>t("span",{class:"font-[500] text-[12px] text-[#EBEBEB] uppercase"},"Transfer",-1)),Qt=u(()=>t("span",{class:"text-[12px] font-[400] u-line-1"},"record",-1)),Kt=u(()=>t("span",{class:"iconfont icon-gengduo11"},null,-1)),Xt=[Qt,Kt],Yt=u(()=>t("ul",{class:"w-full flex flex-col justify-center"},[t("li",{class:"text-[#b2aead] text-[11px] flex items-center space-x-1"},[t("span",{class:"text-[18px]"},"·"),t("span",{class:"text-[#B0B0B0] text-[11px] u-line-1"}," Only users with Godhood ID card can transfer tickets. ")])],-1)),Zt={class:"flex flex-col justify-between pt-5 pb-10 relative"},te=u(()=>t("p",{class:"text-center z-10 text-[#ebebeb] text-[30px] font-[700] font-display uppercase"}," Purchase Ticket ",-1)),ee={class:"z-10 px-10 space-y-10"},se={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-4 gap-6 px-2"},oe=["onClick"],ae={class:"ticket-top flex flex-col items-center space-y-2 py-6 sm:py-7 md:py-8"},ne=u(()=>t("p",{class:"font-bold text-[18px] xs:text-[20px] sm:text-[22px] font-display text-white"}," EMO LAB",-1)),ce=u(()=>t("div",{class:"w-[65%]"},[t("img",{src:K,alt:"",class:"w-full h-auto"})],-1)),le={class:"flex flex-col items-center font-display pt-2"},ie={class:"text-[30px] sm:text-[35px] md:text-[40px] font-bold num-gradient leading-[1]"},re={class:"text-[14px] sm:text-[16px] md:text-[18px] font-bold text-white uppercase"},de=u(()=>t("div",{class:"notch notch-left"},null,-1)),ue=u(()=>t("div",{class:"notch notch-right"},null,-1)),pe={class:"ticket-bottom space-y-2"},fe={class:"flex items-end justify-between flex-wrap"},xe={class:"text-[20px] xs:text-[22px] sm:text-[24px] md:text-[26px] lg:text-[24px] font-bold text-white"},_e={class:"line-through font-sans text-[14px] sm:text-[16px] md:text-[16px] lg:text-[16px] text-[#707070]"},me=u(()=>t("ul",{class:"w-full flex flex-col justify-center ml-5"},[t("li",{class:"text-[#b2aead] text-[11px] flex items-center space-x-1"},[t("span",{class:"text-[18px]"},"·"),t("span",{class:"text-[#B0B0B0] text-[11px] u-line-1"}," Only users with Godhood ID card can purchase. ")]),t("li",{class:"text-[#b2aead] text-[11px] flex items-center space-x-1 -mt-2"},[t("span",{class:"text-[18px]"},"·"),t("span",{class:"text-[#B0B0B0] text-[11px] u-line-1"}," 1.99USD can only be purchased once per account. ")]),t("li",{class:"text-[#b2aead] text-[11px] flex items-center space-x-1 -mt-2"},[t("span",{class:"text-[18px]"},"·"),t("span",{class:"text-[#B0B0B0] text-[11px] u-line-1"}," Each ticket package is limited to one discount. ")])],-1)),he=q({__name:"BuyTicket",props:{dialogVisible:{type:Boolean,default:!1}},emits:["update:closeDialog"],setup(l,{emit:p}){const f=G(),s=v(!1),e=v(!1),a=v(!1),n=v(1),o=v({}),i=W(),c=v(!1),g=v(!1),m=v(),w=v([{level:4,afterDiscount:.4,beforeDiscount:.42,quantity:1},{level:1,afterDiscount:1.99,beforeDiscount:4,quantity:10},{level:2,afterDiscount:19.9,beforeDiscount:22,quantity:55},{level:3,afterDiscount:69.9,beforeDiscount:80,quantity:200}]),y=ct({uids:""}),D=()=>{p("update:closeDialog"),y.uids=""},E=async()=>{var x;try{if(g.value=!0,H(f.getToken))return _.warning("Please login first");if(!i.getIsPayCard)return _.warning("Only users with Godhood ID card can transfer tickets");const r=y.uids.split(`
`).filter(C=>C.trim()!=="");if(((x=m.value)==null?void 0:x.total)<r.length*n.value)return _.warning("Insufficient ticket balance");const T=[],U=[];for(const C of r){const k=C.trim();k===f.getUserInfo.uid&&U.push(k),/^\d{14}$/.test(k)||T.push(k)}if(U.length>0){_.warning(`Cannot transfer tickets to yourself: ${f.getUserInfo.uid}`);return}if(T.length>0){_.warning(`The following UIDs are invalid, must be 14-digit numbers: ${T.join(", ")}`);return}const R=r.join(","),b=await vt({uids:R,number:n.value});b.code===200?(_.success(b.msg),y.uids="",m.value&&(m.value.total=(m.value.total||0)-n.value)):_.error(b.msg||b.data||b.message)}catch{}finally{g.value=!1}},L=async x=>{if(!i.getIsPayCard)return _.warning("Only users with Godhood ID card can purchase.");if(!a.value){if(x.level===1&&!c.value)return _.warning("1.99USD can only be purchased once per account");e.value=!0,o.value=x}},V=async()=>{try{const x=await yt();m.value=x}catch{}},Y=async()=>{Z(),!H(f.getToken)&&V()},Z=async()=>{try{if(c.value)return;a.value=!0,c.value=await Dt()}catch{a.value=!1}finally{a.value=!1}},tt=async()=>{c.value=!1,V()};return(x,r)=>{const T=xt,U=_t,R=It,b=Et,C=Tt,k=mt,et=ht,st=gt;return A(),lt(et,null,{default:z(()=>[B(k,{class:"border-box",draggable:"","model-value":x.$props.dialogVisible,"show-close":!1,style:{background:"rgba(0, 0, 0, 1)",border:"2px solid #2B2B2B","border-radius":"20px",padding:"10px 0",width:"fit-content"},center:"",onClose:D,onOpen:Y,"append-to-body":!1},{default:z(()=>{var O,M;return[t("span",{class:"iconfont icon-del text-sm absolute top-3 right-5 text-[#EDEDED] cursor-pointer",onClick:D}),t("div",Ct,[t("div",At,[Ut,Pt,t("div",$t,[St,t("div",Lt,[Rt,t("span",zt,I(((O=d(m))==null?void 0:O.total)||0),1)])]),t("div",Ht,[t("div",jt,[Vt,t("div",Ot,[B(T,{modelValue:d(y).uids,"onUpdate:modelValue":r[0]||(r[0]=h=>d(y).uids=h),autosize:{minRows:1,maxRows:4},type:"textarea",placeholder:"Please input"},null,8,["modelValue"]),Mt])]),t("div",Nt,[qt,t("div",Gt,[t("div",{class:"text-white px-2 text-[1.25rem] font-bold cursor-pointer select-none",onClick:r[1]||(r[1]=h=>d(n)>1&&n.value--)},"-"),t("span",Wt,I(d(n)),1),t("div",{class:"text-white px-2 text-xl font-bold cursor-pointer select-none",onClick:r[2]||(r[2]=h=>n.value++)},"+")])])]),t("div",Ft,[B(U,{class:"w-[150px] hover:scale-105 duration-500",color:"#2b2b2b",style:{height:"32px"},onClick:r[3]||(r[3]=h=>("throttle"in x?x.throttle:d(wt))(()=>{E()})),laoding:d(g),disabled:("isEmpty"in x?x.isEmpty:d(H))(d(y).uids)&&((M=d(m))==null?void 0:M.total)>0},{default:z(()=>[Jt]),_:1},8,["laoding","disabled"]),t("div",{class:"flex items-center text-[#B2B2B2] cursor-pointer hover:text-[#EBEBEB]",onClick:r[4]||(r[4]=h=>s.value=!0)},Xt)]),Yt]),t("div",Zt,[te,it((A(),P("div",ee,[t("div",se,[(A(!0),P(rt,null,dt(d(w),(h,ot)=>(A(),P("div",{class:"ticket-rack w-full max-w-[220px]",key:ot},[t("div",{class:ut(["",!d(i).getIsPayCard||!d(c)&&h.level===1?"opacity-50 cursor-not-allowed":"ticket-wrapper"]),onClick:ve=>L(h)},[t("div",ae,[ne,ce,t("div",le,[t("div",ie,I(h.quantity),1),t("div",re,I(h.quantity>1?"tickets":"ticket"),1)]),de,ue]),t("div",pe,[t("div",fe,[t("span",xe," $"+I(h.afterDiscount),1),t("span",_e," $"+I(h.beforeDiscount),1)]),B(R)])],10,oe)]))),128))]),me])),[[st,d(a)]]),B(b,{"dialog-visible":d(e),item:d(o),"onUpdate:closeDialog":r[5]||(r[5]=h=>e.value=!1),"onUpdate:success":tt},null,8,["dialog-visible","item"]),B(C,{"dialog-visible":d(s),"onUpdate:closeDialog":r[6]||(r[6]=h=>s.value=!1)},null,8,["dialog-visible"])])])]}),_:1},8,["model-value"])]),_:1})}}});const ge=Q(he,[["__scopeId","data-v-1fe91fef"]]),Se=Object.freeze(Object.defineProperty({__proto__:null,default:ge},Symbol.toStringTag,{value:"Module"}));export{Se as B,$e as a,Pe as b};
